---
description: Canonical high-level context for Hush (Hinkal + private Aave WebCLI).
globs: *
---

# PROJECT CONTEXT

Hush is a browser WebCLI for private DeFi actions on top of Aave.
The active runtime is WebCLI only (`src/webcli/app.ts`); there is no server CLI.

# ACTIVE ARCHITECTURE (STRICT)

1. User connects injected wallet and signs session message.
2. WebCLI initializes Hinkal session from mnemonic + signer.
3. Public token flow: `approve` -> `shield` -> private spendable balance.
4. Private Aave flow: `private-supply`, `private-withdraw`, `private-borrow`, `private-repay`.
5. Adapter/factory/vault contracts isolate positions by `zkOwnerHash`.
6. Private outputs route through Emporium so funds return to private balance.

# TECH STACK

1. Frontend: TypeScript + Vite
2. Package manager: Bun
3. Contracts: Solidity + Foundry
4. Web3: Ethers v5
5. Privacy SDK: `@hinkal/common`
6. Network target: Arbitrum One (`42161`)

# COMMAND SURFACE (CURRENT)

1. `help`, `clear`
2. `login`, `login-test`, `import`
3. `approve`, `shield`, `unshield`, `unshield-weth`, `private-balance`
4. `private-supply`, `supply-positions`, `private-withdraw`
5. `private-borrow`, `private-repay`

# NON-NEGOTIABLE GUARDRAILS

1. Keep private destination semantics for `private-withdraw` (recipient is Emporium).
2. Preserve auth secret lifecycle for positions (rotate after borrow/repay/partial-withdraw, remove on close).
3. Preserve fee reserve preflight checks for private Aave actions.
4. Preserve one-vault-per-`zkOwnerHash` behavior in contracts.
5. Do not re-introduce legacy Railgun flows as active behavior.
