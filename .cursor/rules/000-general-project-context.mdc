---
description: Current canonical context for Private Better (Hinkal + private Aave WebCLI).
globs: *
---

# PROJECT CONTEXT

Private Better currently runs a Hinkal-first private DeFi flow on Arbitrum.
The active product surface is the browser WebCLI (`src/webcli/app.ts`).

# ACTIVE ARCHITECTURE (STRICT)

1. User signs with injected wallet (Rabby/MetaMask/Coinbase).
2. Hinkal session is initialized from mnemonic and wallet signer.
3. Public USDC can be shielded/unshielded via Hinkal contract.
4. Private supply uses Emporium ops:
   - transfer USDC from Emporium to adapter,
   - call adapter `onPrivateDeposit(...)`.
5. Adapter supplies into per-owner vault/Aave position.
6. Private withdraw executes adapter `withdrawToRecipient(...)` and returns funds to private balance.

# TECH STACK

- **Frontend:** TypeScript + Vite WebCLI
- **Package manager:** bun v1.2.17+
- **Smart Contracts:** Solidity ^0.8.20 (Foundry)
- **Web3:** Ethers.js v5.7.2
- **Privacy SDK:** `@hinkal/common`
- **Yield Protocol:** Aave via custom adapter/vault contracts
- **Network:** Arbitrum One (chainId 42161)

# CODING RULES

1. **MVP First:** Prefer simple, verifiable happy-path implementations.
2. **Privacy First:** Keep supply/withdraw identity private via Hinkal action flow.
3. **Isolation First:** Preserve one-vault-per-`zkOwnerHash`.
4. **No Hallucinations:** Verify method signatures from installed SDK/contracts.
5. **Do Not Edit `node_modules`:** Fix via app code or config only.

# OPERATIONAL NOTES

1. `private-withdraw` is private-destination by default (not public recipient).
2. Position secrets are stored locally and rotated on partial withdraw.
3. Hinkal fees are runtime-estimated; keep private USDC reserve.
4. Fee reserve guard is implemented in WebCLI preflight for supply/withdraw.
5. Product focus is private supply; private borrow is planned next.
